<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuizMe - Interactive Quiz Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 5px;
        }

        .nav-tab {
            padding: 12px 24px;
            margin: 0 5px;
            background: transparent;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .nav-tab:hover {
            background: rgba(255,255,255,0.2);
        }

        .nav-tab.active {
            background: rgba(255,255,255,0.3);
            font-weight: bold;
        }

        .section {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .quiz-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .quiz-card {
            background: rgba(255,255,255,0.15);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .quiz-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        .quiz-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 10px;
        }

        .quiz-title {
            font-size: 1.3em;
            font-weight: bold;
            flex-grow: 1;
        }

        .heart-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            transition: transform 0.2s ease;
            margin-left: 10px;
        }

        .heart-btn:hover {
            transform: scale(1.2);
        }

        .heart-btn.favorited {
            color: #ff6b6b;
        }

        .heart-btn:not(.favorited) {
            color: rgba(255,255,255,0.5);
        }

        .quiz-description {
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .quiz-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            opacity: 0.7;
            margin-bottom: 15px;
        }

        .quiz-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .btn {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.2);
            margin-left: 10px;
        }

        .create-quiz-form {
            background: rgba(255,255,255,0.15);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 16px;
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: rgba(255,255,255,0.7);
        }

        .question-builder {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .remove-question {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
        }

        .answers-container {
            margin-top: 15px;
        }

        .answer-group {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .answer-group input[type="text"] {
            flex-grow: 1;
            margin-right: 10px;
        }

        .answer-group input[type="radio"] {
            margin-right: 10px;
        }

        .file-upload {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-upload input[type="file"] {
            flex-grow: 1;
        }

        .preview-image {
            max-width: 200px;
            max-height: 150px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 2em;
            font-weight: bold;
        }

        .import-area {
            background: rgba(255,255,255,0.1);
            border: 2px dashed rgba(255,255,255,0.3);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .import-area:hover {
            border-color: rgba(255,255,255,0.5);
            background: rgba(255,255,255,0.15);
        }

        .quiz-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255,255,255,0.15);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            flex: 1;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close-modal {
            float: right;
            font-size: 24px;
            cursor: pointer;
            color: white;
        }

        .quiz-question {
            margin-bottom: 20px;
        }

        .quiz-options {
            margin-left: 20px;
        }

        .quiz-options label {
            display: block;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .quiz-results {
            text-align: center;
            padding: 20px;
        }

        .score {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>QuizMe</h1>
            <p class="subtitle">Create, Share, and Take Amazing Quizzes</p>
        </header>

        <nav class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('home')">Home</button>
            <button class="nav-tab" onclick="showSection('favorites')">Favorites</button>
            <button class="nav-tab" onclick="showSection('my-quizzes')">My Quizzes</button>
            <button class="nav-tab" onclick="showSection('community')">Community Quizzes</button>
            <button class="nav-tab" onclick="showSection('create')">Create Quiz</button>
            <button class="nav-tab" onclick="showSection('import')">Import Quiz</button>
        </nav>

        <!-- Home Section -->
        <div id="home" class="section active">
            <div class="quiz-stats">
                <div class="stat-card">
                    <div class="stat-number" id="total-quizzes">0</div>
                    <div>Total Quizzes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="my-quiz-count">0</div>
                    <div>My Quizzes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="community-quiz-count">0</div>
                    <div>Community Quizzes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="favorites-count">0</div>
                    <div>Favorites</div>
                </div>
            </div>

            <div class="section-header">
                <h2 class="section-title">Recent Quizzes</h2>
            </div>
            <div id="recent-quizzes" class="quiz-grid">
                <!-- Recent quizzes will be populated here -->
            </div>
        </div>

        <!-- Favorites Section -->
        <div id="favorites" class="section">
            <div class="section-header">
                <h2 class="section-title">Your Favorite Quizzes</h2>
            </div>
            <div id="favorites-grid" class="quiz-grid">
                <!-- Favorite quizzes will be populated here -->
            </div>
        </div>

        <!-- My Quizzes Section -->
        <div id="my-quizzes" class="section">
            <div class="section-header">
                <h2 class="section-title">My Quizzes</h2>
                <button class="btn" onclick="showSection('create')">Create New Quiz</button>
            </div>
            <div id="my-quizzes-grid" class="quiz-grid">
                <!-- My quizzes will be populated here -->
            </div>
        </div>

        <!-- Community Quizzes Section -->
        <div id="community" class="section">
            <div class="section-header">
                <h2 class="section-title">All Quizzes</h2>
                <div style="display: flex; gap: 10px;">
                    <select id="category-filter" onchange="filterQuizzes()" style="padding: 8px; border-radius: 5px; background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3);">
                        <option value="">All Categories</option>
                        <option value="general">General Knowledge</option>
                        <option value="science">Science</option>
                        <option value="history">History</option>
                        <option value="sports">Sports</option>
                        <option value="entertainment">Entertainment</option>
                        <option value="technology">Technology</option>
                        <option value="art">Art & Literature</option>
                        <option value="other">Other</option>
                    </select>
                    <select id="author-filter" onchange="filterQuizzes()" style="padding: 8px; border-radius: 5px; background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3);">
                        <option value="">All Authors</option>
                    </select>
                </div>
            </div>
            <div id="community-grid" class="quiz-grid">
                <!-- All quizzes will be populated here -->
            </div>
        </div>

        <!-- Create Quiz Section -->
        <div id="create" class="section">
            <div class="section-header">
                <h2 class="section-title">Create New Quiz</h2>
            </div>
            
            <form class="create-quiz-form" id="quiz-form">
                <div class="form-group">
                    <label for="quiz-title">Quiz Title</label>
                    <input type="text" id="quiz-title" placeholder="Enter quiz title" required>
                </div>
                
                <div class="form-group">
                    <label for="quiz-description">Description</label>
                    <textarea id="quiz-description" placeholder="Describe your quiz" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="quiz-image">Quiz Cover Image</label>
                    <div class="file-upload">
                        <input type="file" id="quiz-image" accept="image/*" onchange="previewImage(event, 'quiz-preview')">
                    </div>
                    <img id="quiz-preview" class="preview-image" style="display: none;">
                </div>
                
                <div class="form-group">
                    <label for="quiz-category">Category</label>
                    <select id="quiz-category">
                        <option value="general">General Knowledge</option>
                        <option value="science">Science</option>
                        <option value="history">History</option>
                        <option value="sports">Sports</option>
                        <option value="entertainment">Entertainment</option>
                        <option value="technology">Technology</option>
                        <option value="art">Art & Literature</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div id="questions-container">
                    <h3>Questions</h3>
                </div>
                
                <button type="button" class="btn" onclick="addQuestion()">Add Question</button>
                <button type="submit" class="btn" style="margin-left: 10px;">Save Quiz</button>
            </form>
        </div>

        <!-- Import Quiz Section -->
        <div id="import" class="section">
            <div class="section-header">
                <h2 class="section-title">Import Quiz</h2>
            </div>
            
            <div class="import-area" onclick="document.getElementById('import-file').click()">
                <h3>Drop a JSON file here or click to browse</h3>
                <p>Import quizzes in JSON format</p>
                <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importQuiz(event)">
            </div>
            
            <div class="create-quiz-form">
                <h3>JSON Format Example:</h3>
                <pre style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; overflow-x: auto;">
{
  "title": "Sample Quiz",
  "description": "A sample quiz",
  "category": "general",
  "questions": [
    {
      "question": "What is 2+2?",
      "answers": ["3", "4", "5", "6"],
      "correct": 1,
      "image": ""
    }
  ]
}
                </pre>
            </div>
        </div>
    </div>

    <!-- Quiz Modal -->
    <div id="quiz-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeQuizModal()">&times;</span>
            <div id="quiz-content">
                <!-- Quiz content will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        let quizzes = [];
        let favorites = new Set();
        let currentQuiz = null;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let questionCounter = 0;
        let currentUser = 'You'; // Default user name

        // Add user identification system
        function initializeUser() {
            let userName = prompt("Welcome to QuizMe! What's your name?");
            if (!userName || userName.trim() === '') {
                userName = 'Anonymous_' + Date.now().toString().slice(-4);
            }
            currentUser = userName.trim();
            
            // Update UI to show current user
            document.querySelector('.subtitle').textContent = `Welcome ${currentUser}! Create, Share, and Take Amazing Quizzes`;
        }

        // Initialize the app
        function init() {
            initializeUser();
            updateStats();
            renderRecentQuizzes();
            
            // Add initial sample quizzes from different users
            if (quizzes.length === 0) {
                addSampleQuizzes();
            }
        }

        function addSampleQuizzes() {
            const sampleQuizzes = [
                {
                    id: Date.now(),
                    title: "World Geography Challenge",
                    description: "Test your knowledge of world capitals and countries",
                    category: "general",
                    author: "Sarah_M",
                    createdAt: new Date(Date.now() - 86400000).toISOString(), // 1 day ago
                    image: "",
                    questions: [
                        {
                            question: "What is the capital of Australia?",
                            answers: ["Sydney", "Melbourne", "Canberra", "Perth"],
                            correct: 2,
                            image: ""
                        },
                        {
                            question: "Which country has the most time zones?",
                            answers: ["Russia", "USA", "China", "Canada"],
                            correct: 0,
                            image: ""
                        }
                    ]
                },
                {
                    id: Date.now() + 1,
                    title: "Science Basics",
                    description: "Fundamental science questions for everyone",
                    category: "science",
                    author: "Dr_Mike",
                    createdAt: new Date(Date.now() - 172800000).toISOString(), // 2 days ago
                    image: "",
                    questions: [
                        {
                            question: "What is the chemical symbol for gold?",
                            answers: ["Go", "Gd", "Au", "Ag"],
                            correct: 2,
                            image: ""
                        },
                        {
                            question: "How many bones are in an adult human body?",
                            answers: ["186", "206", "226", "246"],
                            correct: 1,
                            image: ""
                        }
                    ]
                },
                {
                    id: Date.now() + 2,
                    title: "Movie Trivia",
                    description: "Classic and modern movie questions",
                    category: "entertainment",
                    author: "CinemaFan",
                    createdAt: new Date(Date.now() - 259200000).toISOString(), // 3 days ago
                    image: "",
                    questions: [
                        {
                            question: "Who directed the movie 'Inception'?",
                            answers: ["Steven Spielberg", "Christopher Nolan", "Martin Scorsese", "Quentin Tarantino"],
                            correct: 1,
                            image: ""
                        },
                        {
                            question: "In which year was 'The Godfather' released?",
                            answers: ["1970", "1972", "1974", "1976"],
                            correct: 1,
                            image: ""
                        }
                    ]
                }
            ];
            
            quizzes.push(...sampleQuizzes);
            updateStats();
            renderAllSections();
        }

        function showSection(sectionName) {
            // Hide all sections
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => section.classList.remove('active'));
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected section
            document.getElementById(sectionName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Render section content
            renderSectionContent(sectionName);
        }

        function renderSectionContent(sectionName) {
            switch(sectionName) {
                case 'home':
                    renderRecentQuizzes();
                    break;
                case 'favorites':
                    renderFavorites();
                    break;
                case 'my-quizzes':
                    renderMyQuizzes();
                    break;
                case 'community':
                    renderCommunityQuizzes();
                    break;
            }
        }

        function renderAllSections() {
            renderRecentQuizzes();
            renderFavorites();
            renderMyQuizzes();
            renderCommunityQuizzes();
        }

        function createQuizCard(quiz) {
            const isFavorited = favorites.has(quiz.id);
            const imageHtml = quiz.image ? `<img src="${quiz.image}" alt="${quiz.title}" class="quiz-image">` : '';
            const isMyQuiz = quiz.author === currentUser;
            
            return `
                <div class="quiz-card">
                    ${imageHtml}
                    <div class="quiz-header">
                        <div class="quiz-title">${quiz.title}</div>
                        <button class="heart-btn ${isFavorited ? 'favorited' : ''}" onclick="toggleFavorite(${quiz.id})">
                            ${isFavorited ? '‚ù§Ô∏è' : 'ü§ç'}
                        </button>
                    </div>
                    <div class="quiz-description">${quiz.description}</div>
                    <div class="quiz-meta">
                        <span>By: ${quiz.author}</span>
                        <span>${quiz.questions.length} questions</span>
                    </div>
                    <div class="quiz-meta">
                        <span style="font-size: 0.8em; opacity: 0.6;">Created: ${new Date(quiz.createdAt).toLocaleDateString()}</span>
                    </div>
                    <div style="margin-top: 15px;">
                        <button class="btn" onclick="startQuiz(${quiz.id})">Take Quiz</button>
                        ${isMyQuiz ? `<button class="btn btn-secondary" onclick="editQuiz(${quiz.id})">Edit</button>` : ''}
                        <button class="btn btn-secondary" onclick="exportQuiz(${quiz.id})" title="Download Quiz">üì•</button>
                    </div>
                </div>
            `;
        }

        function renderRecentQuizzes() {
            const container = document.getElementById('recent-quizzes');
            const recentQuizzes = quizzes.slice(-6).reverse();
            container.innerHTML = recentQuizzes.map(createQuizCard).join('');
        }

        function renderFavorites() {
            const container = document.getElementById('favorites-grid');
            const favoriteQuizzes = quizzes.filter(quiz => favorites.has(quiz.id));
            
            if (favoriteQuizzes.length === 0) {
                container.innerHTML = '<p style="text-align: center; opacity: 0.7;">No favorite quizzes yet. Click the heart icon on any quiz to add it to favorites!</p>';
            } else {
                container.innerHTML = favoriteQuizzes.map(createQuizCard).join('');
            }
        }

        function renderMyQuizzes() {
            const container = document.getElementById('my-quizzes-grid');
            const myQuizzes = quizzes.filter(quiz => quiz.author === currentUser);
            
            if (myQuizzes.length === 0) {
                container.innerHTML = '<p style="text-align: center; opacity: 0.7;">You haven\'t created any quizzes yet. Click "Create New Quiz" to get started!</p>';
            } else {
                container.innerHTML = myQuizzes.map(createQuizCard).join('');
            }
        }

        function renderCommunityQuizzes() {
            const container = document.getElementById('community-grid');
            // Show ALL quizzes from all users
            let allQuizzes = quizzes.slice().sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            // Update author filter options
            updateAuthorFilter();
            
            // Apply filters
            const categoryFilter = document.getElementById('category-filter')?.value;
            const authorFilter = document.getElementById('author-filter')?.value;
            
            if (categoryFilter) {
                allQuizzes = allQuizzes.filter(quiz => quiz.category === categoryFilter);
            }
            
            if (authorFilter) {
                allQuizzes = allQuizzes.filter(quiz => quiz.author === authorFilter);
            }
            
            if (allQuizzes.length === 0) {
                container.innerHTML = '<p style="text-align: center; opacity: 0.7;">No quizzes match your filters. Try adjusting the filters or create a new quiz!</p>';
            } else {
                container.innerHTML = allQuizzes.map(createQuizCard).join('');
            }
        }

        function updateAuthorFilter() {
            const authorFilter = document.getElementById('author-filter');
            if (!authorFilter) return;
            
            const authors = [...new Set(quizzes.map(quiz => quiz.author))].sort();
            const currentValue = authorFilter.value;
            
            authorFilter.innerHTML = '<option value="">All Authors</option>' + 
                authors.map(author => `<option value="${author}">${author}</option>`).join('');
            
            if (authors.includes(currentValue)) {
                authorFilter.value = currentValue;
            }
        }

        function filterQuizzes() {
            renderCommunityQuizzes();
        }

        function toggleFavorite(quizId) {
            if (favorites.has(quizId)) {
                favorites.delete(quizId);
            } else {
                favorites.add(quizId);
            }
            updateStats();
            renderAllSections();
        }

        function updateStats() {
            document.getElementById('total-quizzes').textContent = quizzes.length;
            document.getElementById('my-quiz-count').textContent = quizzes.filter(q => q.author === currentUser).length;
            document.getElementById('community-quiz-count').textContent = quizzes.filter(q => q.author !== currentUser).length;
            document.getElementById('favorites-count').textContent = favorites.size;
        }

        function addQuestion() {
            questionCounter++;
            const questionsContainer = document.getElementById('questions-container');
            
            const questionDiv = document.createElement('div');
            questionDiv.className = 'question-builder';
            questionDiv.innerHTML = `
                <div class="question-header">
                    <h4>Question ${questionCounter}</h4>
                    <button type="button" class="remove-question" onclick="removeQuestion(this)">Remove</button>
                </div>
                <div class="form-group">
                    <label>Question Text</label>
                    <input type="text" class="question-text" placeholder="Enter your question" required>
                </div>
                <div class="form-group">
                    <label>Question Image (optional)</label>
                    <input type="file" class="question-image" accept="image/*" onchange="previewQuestionImage(event)">
                    <img class="preview-image question-preview" style="display: none;">
                </div>
                <div class="answers-container">
                    <label>Answer Options (select the correct one)</label>
                    <div class="answer-group">
                        <input type="radio" name="correct-${questionCounter}" value="0">
                        <input type="text" placeholder="Answer 1" required>
                    </div>
                    <div class="answer-group">
                        <input type="radio" name="correct-${questionCounter}" value="1">
                        <input type="text" placeholder="Answer 2" required>
                    </div>
                    <div class="answer-group">
                        <input type="radio" name="correct-${questionCounter}" value="2">
                        <input type="text" placeholder="Answer 3" required>
                    </div>
                    <div class="answer-group">
                        <input type="radio" name="correct-${questionCounter}" value="3">
                        <input type="text" placeholder="Answer 4" required>
                    </div>
                </div>
            `;
            
            questionsContainer.appendChild(questionDiv);
        }

        function removeQuestion(button) {
            button.closest('.question-builder').remove();
        }

        function previewImage(event, previewId) {
            const file = event.target.files[0];
            const preview = document.getElementById(previewId);
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        function previewQuestionImage(event) {
            const file = event.target.files[0];
            const preview = event.target.nextElementSibling;
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        // Handle quiz form submission
        document.getElementById('quiz-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const title = document.getElementById('quiz-title').value;
            const description = document.getElementById('quiz-description').value;
            const category = document.getElementById('quiz-category').value;
            const quizImageFile = document.getElementById('quiz-image').files[0];
            
            // Get all questions
            const questionBuilders = document.querySelectorAll('.question-builder');
            const questions = [];
            
            questionBuilders.forEach(builder => {
                const questionText = builder.querySelector('.question-text').value;
                const answerInputs = builder.querySelectorAll('.answer-group input[type="text"]');
                const correctRadio = builder.querySelector('input[type="radio"]:checked');
                const imageFile = builder.querySelector('.question-image').files[0];
                
                if (questionText && correctRadio) {
                    const answers = Array.from(answerInputs).map(input => input.value);
                    const correct = parseInt(correctRadio.value);
                    
                    const question = {
                        question: questionText,
                        answers: answers,
                        correct: correct,
                        image: imageFile ? URL.createObjectURL(imageFile) : ''
                    };
                    
                    questions.push(question);
                }
            });
            
            if (questions.length === 0) {
                alert('Please add at least one question!');
                return;
            }
            
            const quiz = {
                id: Date.now(),
                title: title,
                description: description,
                category: category,
                author: currentUser,
                createdAt: new Date().toISOString(),
                image: quizImageFile ? URL.createObjectURL(quizImageFile) : '',
                questions: questions
            };
            
            quizzes.push(quiz);
            updateStats();
            renderAllSections();
            
            // Reset form
            document.getElementById('quiz-form').reset();
            document.getElementById('questions-container').innerHTML = '<h3>Questions</h3>';
            document.getElementById('quiz-preview').style.display = 'none';
            questionCounter = 0;
            
            alert('Quiz created successfully!');
            showSection('my-quizzes');
        });

        function importQuiz(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const quizData = JSON.parse(e.target.result);
                    
                    // Validate quiz data
                    if (!quizData.title || !quizData.questions || !Array.isArray(quizData.questions)) {
                        throw new Error('Invalid quiz format');
                    }
                    
                    const quiz = {
                        id: Date.now(),
                        title: quizData.title,
                        description: quizData.description || '',
                        category: quizData.category || 'general',
                        author: quizData.author || 'Imported_User',
                        createdAt: new Date().toISOString(),
                        image: quizData.image || '',
                        questions: quizData.questions
                    };
                    
                    quizzes.push(quiz);
                    updateStats();
                    renderAllSections();
                    
                    alert('Quiz imported successfully!');
                    showSection('community');
                } catch (error) {
                    alert('Error importing quiz: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function startQuiz(quizId) {
            currentQuiz = quizzes.find(q => q.id === quizId);
            currentQuestionIndex = 0;
            userAnswers = [];
            
            showQuizModal();
            displayQuestion();
        }

        function showQuizModal() {
            document.getElementById('quiz-modal').style.display = 'block';
        }

        function closeQuizModal() {
            document.getElementById('quiz-modal').style.display = 'none';
            currentQuiz = null;
            currentQuestionIndex = 0;
            userAnswers = [];
        }

        function displayQuestion() {
            if (!currentQuiz || currentQuestionIndex >= currentQuiz.questions.length) {
                showQuizResults();
                return;
            }

            const question = currentQuiz.questions[currentQuestionIndex];
            const totalQuestions = currentQuiz.questions.length;
            const questionNumber = currentQuestionIndex + 1;

            const imageHtml = question.image ? `<img src="${question.image}" alt="Question image" class="quiz-image" style="margin-bottom: 20px;">` : '';

            document.getElementById('quiz-content').innerHTML = `
                <h2>${currentQuiz.title}</h2>
                <p style="opacity: 0.7; margin-bottom: 20px;">Question ${questionNumber} of ${totalQuestions}</p>
                <div class="quiz-question">
                    ${imageHtml}
                    <h3>${question.question}</h3>
                    <div class="quiz-options">
                        ${question.answers.map((answer, index) => `
                            <label>
                                <input type="radio" name="quiz-answer" value="${index}">
                                ${answer}
                            </label>
                        `).join('')}
                    </div>
                </div>
                <div style="margin-top: 30px;">
                    <button class="btn" onclick="nextQuestion()">
                        ${questionNumber === totalQuestions ? 'Finish Quiz' : 'Next Question'}
                    </button>
                    ${questionNumber > 1 ? '<button class="btn btn-secondary" onclick="previousQuestion()">Previous</button>' : ''}
                </div>
            `;
        }

        function nextQuestion() {
            const selectedAnswer = document.querySelector('input[name="quiz-answer"]:checked');
            
            if (!selectedAnswer) {
                alert('Please select an answer before continuing.');
                return;
            }

            userAnswers[currentQuestionIndex] = parseInt(selectedAnswer.value);
            currentQuestionIndex++;
            displayQuestion();
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
                
                // Pre-select the previously chosen answer
                setTimeout(() => {
                    if (userAnswers[currentQuestionIndex] !== undefined) {
                        const radio = document.querySelector(`input[name="quiz-answer"][value="${userAnswers[currentQuestionIndex]}"]`);
                        if (radio) radio.checked = true;
                    }
                }, 100);
            }
        }

        function showQuizResults() {
            let score = 0;
            currentQuiz.questions.forEach((question, index) => {
                if (userAnswers[index] === question.correct) {
                    score++;
                }
            });

            const percentage = Math.round((score / currentQuiz.questions.length) * 100);
            
            let message = '';
            if (percentage >= 90) message = 'Excellent! üéâ';
            else if (percentage >= 70) message = 'Great job! üëè';
            else if (percentage >= 50) message = 'Good effort! üëç';
            else message = 'Keep practicing! üí™';

            document.getElementById('quiz-content').innerHTML = `
                <div class="quiz-results">
                    <h2>Quiz Complete!</h2>
                    <div class="score">${score}/${currentQuiz.questions.length}</div>
                    <p style="font-size: 1.2em; margin-bottom: 10px;">${percentage}%</p>
                    <p style="font-size: 1.1em; margin-bottom: 30px;">${message}</p>
                    
                    <h3>Review Your Answers:</h3>
                    <div style="text-align: left; margin: 20px 0;">
                        ${currentQuiz.questions.map((question, index) => {
                            const userAnswer = userAnswers[index];
                            const isCorrect = userAnswer === question.correct;
                            return `
                                <div style="margin-bottom: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                                    <p><strong>Q${index + 1}: ${question.question}</strong></p>
                                    <p style="color: ${isCorrect ? '#4CAF50' : '#f44336'};">
                                        Your answer: ${question.answers[userAnswer]} ${isCorrect ? '‚úÖ' : '‚ùå'}
                                    </p>
                                    ${!isCorrect ? `<p style="color: #4CAF50;">Correct answer: ${question.answers[question.correct]} ‚úÖ</p>` : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <button class="btn" onclick="closeQuizModal()">Close</button>
                    <button class="btn btn-secondary" onclick="retakeQuiz()">Retake Quiz</button>
                </div>
            `;
        }

        function retakeQuiz() {
            currentQuestionIndex = 0;
            userAnswers = [];
            displayQuestion();
        }

        function editQuiz(quizId) {
            const quiz = quizzes.find(q => q.id === quizId);
            if (!quiz) return;

            // Fill the form with existing quiz data
            document.getElementById('quiz-title').value = quiz.title;
            document.getElementById('quiz-description').value = quiz.description;
            document.getElementById('quiz-category').value = quiz.category;

            // Clear existing questions
            document.getElementById('questions-container').innerHTML = '<h3>Questions</h3>';
            questionCounter = 0;

            // Add questions to form
            quiz.questions.forEach((question, index) => {
                addQuestion();
                const questionBuilder = document.querySelectorAll('.question-builder')[index];
                
                questionBuilder.querySelector('.question-text').value = question.question;
                
                const answerInputs = questionBuilder.querySelectorAll('.answer-group input[type="text"]');
                question.answers.forEach((answer, answerIndex) => {
                    answerInputs[answerIndex].value = answer;
                });
                
                const correctRadio = questionBuilder.querySelector(`input[type="radio"][value="${question.correct}"]`);
                if (correctRadio) correctRadio.checked = true;
            });

            // Remove the quiz from the array (it will be re-added when saved)
            quizzes = quizzes.filter(q => q.id !== quizId);
            updateStats();

            // Switch to create section
            showSection('create');
        }

        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('quiz-modal');
            if (event.target === modal) {
                closeQuizModal();
            }
        });

        // Add some initial questions when creating a new quiz
        function addInitialQuestion() {
            if (document.querySelectorAll('.question-builder').length === 0) {
                addQuestion();
            }
        }

        // Initialize the app when page loads
        window.addEventListener('load', function() {
            init();
            
            // Add event listener for the create tab to add initial question
            const createTab = document.querySelector('[onclick="showSection(\'create\')"]');
            createTab.addEventListener('click', function() {
                setTimeout(addInitialQuestion, 100);
            });
        });

        // Handle drag and drop for import
        const importArea = document.querySelector('.import-area');
        
        importArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.style.borderColor = 'rgba(255,255,255,0.7)';
            this.style.background = 'rgba(255,255,255,0.2)';
        });

        importArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.style.borderColor = 'rgba(255,255,255,0.3)';
            this.style.background = 'rgba(255,255,255,0.1)';
        });

        importArea.addEventListener('drop', function(e) {
            e.preventDefault();
            this.style.borderColor = 'rgba(255,255,255,0.3)';
            this.style.background = 'rgba(255,255,255,0.1)';
            
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].type === 'application/json') {
                const event = { target: { files: files } };
                importQuiz(event);
            }
        });

        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (currentQuiz) {
                if (e.key === 'Escape') {
                    closeQuizModal();
                } else if (e.key === 'Enter' && document.querySelector('input[name="quiz-answer"]:checked')) {
                    nextQuestion();
                } else if (e.key >= '1' && e.key <= '4') {
                    const index = parseInt(e.key) - 1;
                    const radio = document.querySelector(`input[name="quiz-answer"][value="${index}"]`);
                    if (radio) radio.checked = true;
                }
            }
        });

        // Auto-save functionality (using memory storage)
        let autoSaveTimer;
        
        function startAutoSave() {
            clearTimeout(autoSaveTimer);
            autoSaveTimer = setTimeout(function() {
                // In a real app, this would save to a server
                console.log('Auto-saving quiz data...');
            }, 5000);
        }

        // Add event listeners to form inputs for auto-save
        document.getElementById('quiz-form').addEventListener('input', startAutoSave);

        // Export quiz functionality
        function exportQuiz(quizId) {
            const quiz = quizzes.find(q => q.id === quizId);
            if (!quiz) return;

            const exportData = {
                title: quiz.title,
                description: quiz.description,
                category: quiz.category,
                questions: quiz.questions.map(q => ({
                    question: q.question,
                    answers: q.answers,
                    correct: q.correct,
                    image: q.image
                }))
            };

            const dataStr = JSON.stringify(exportData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `${quiz.title.replace(/[^a-z0-9]/gi, '_').toLowerCase()}_quiz.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }
    </script>
</body>
</html>